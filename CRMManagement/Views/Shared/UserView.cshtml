@model EZMasterSetup.clsControlsVM
@{

    var sectionname = "heading";
    var intCount = 0;
    var intHeaderRecord = 0;

    var intRowNumber = 0;
    var strVar = "";
    int intVar = 0;
    double dblVar = 0;

    var userName = (String)Session["UserName"];
    var companyCode = (String)Session["CompanyCode"];
    var FYear = (String)Session["FYear"];
    var SectionId = @ViewBag.SectionId;
    var oprType = @ViewBag.oprType;
   
}


<body>
    <div class="row"><i class="fa fa-adn " aria-hidden="true" style="color:cornflowerblue"> @Html.ActionLink("Back to List", "Index", new { CmpyCode = @companyCode, Id = @SectionId, userName = @userName })</i></div>
    @if (Model.commonEditDisplay == false)
    {
        for (int i = 0; i < Model.sectionMaster.Where(e => e.isApplicableForTable == 0).Distinct().Count(); i += 3)
        {
            <div class="row">

                @foreach (var item in Model.sectionMaster.Distinct().Skip(i).Take(3))
                {
                    if (item.isApplicableForTable == 0)
                    {
                        foreach (var GroupDesc in Model.controls.GroupBy(e => new { e.GroupDescription, e.SectionCode }))
                        {
                            <div class="col-md-4">
                                <div class="card card-info">
                                    <div class="card-header">
                                        <h6 class="card-title">@GroupDesc.Key.GroupDescription</h6>
                                    </div>
                                    <div class="card-body">
                                        @foreach (var control in Model.controls.Where(e => e.GroupDescription == GroupDesc.Key.GroupDescription.ToString() && e.isApplicableForTable == 0))
                                        {
                                            intHeaderRecord = intHeaderRecord + 1;
                                            <div class="form-group">
                                                @Html.Partial("_ControlView", control)
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    }

                }
            </div>
        }
        //for (int i = 0; i < Model.sectionMaster.Where(e => e.isApplicableForTable == 1).Distinct().Count(); i++)
        foreach (var item in Model.sectionMaster.Where(e => e.isApplicableForTable == 1))
        {
            intCount = 0;


            <div class="col-md-12">
                <div class="card card-info">
                    <div class="card-header">
                        <h6 class="card-title">@item.Description</h6>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <table class="table table-hover" id="Table@(item.SectionCode)">
                                <thead>
                                    <tr>
                                        @foreach (var col in Model.ezTemplateMaster.Distinct().Where(m => m.SectionCode == item.SectionCode))
                                        {
                                            if (col.isHidden == 1)
                                            {
                                                <th scope="col" hidden>@col.LableName</th>
                                            }
                                            else
                                            {
                                                <th scope="col">@col.LableName</th>
                                            }
                                            intCount = intCount + 1;
                                        }
                                    </tr>
                                </thead>
                                <tbody id="@(item.SectionCode)">
                                    @{
                                        var intTotalRecordForSection = Model.controls.Where(m => m.SectionCode == item.SectionCode).Count();
                                        var intTotalRecord = intTotalRecordForSection / @intCount;// ((Model.controls.Count- intHeaderRecord) / @intCount);
                                        var intCurRecordNumber = 0;
                                        var intColumnCount = 0;
                                    }

                                    @for (int intRecord = 1; intRecord <= intTotalRecord; intRecord++)
                                    {

                                        <tr>
                                            @for (int i = intCurRecordNumber; intCurRecordNumber <= Model.controls.Where(m => m.SectionCode == item.SectionCode).Count() + intHeaderRecord; i++)
                                            {
                                                var control = Model.controls[i];
                                                if (item.SectionCode == control.SectionCode)
                                                {
                                                    <td>@Html.Partial("_ControlView", control)</td>
                                                    intColumnCount = intColumnCount + 1;
                                                }
                                                intCurRecordNumber++;
                                                //Checking condition for column count reach to end or equal to total columns
                                                if (intCount == intColumnCount)
                                                {
                                                    intColumnCount = 0;
                                                    break;
                                                }
                                            }
                                        </tr>
                                    }

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        @Html.Partial("ForEditDisplayRecordView", Model)
    }
    @*<div class="accordion col-md-12 " id="accordionExample">
            @if (Model.commonEditDisplay == false)
            {
                foreach (var item in Model.sectionMaster.Distinct())
                {
                    <div class="card border-info mb-3 col-md-12">
                        <div class="card-header border-info mb-3" id="heading@(item.SectionCode)">
                            <h4 class="mb-0">
                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse@(item.SectionCode)" aria-expanded="true" aria-controls="collapse@(item.SectionCode)">
                                    <div class="col-md-12">
                                        @Model.workflowInformation.ModuleDesc -  @item.Description
                                    </div>
                                </button>
                            </h4>
                        </div>
                        @if (item.isApplicableForTable == 0)
                        {
                            <div id="collapse@(item.SectionCode)" class="collapse show" aria-labelledby="heading@(item.SectionCode)" data-parent="#accordionExample">
                                <div class="card-body col-md-12">
                                    Printing All Headers
                                    @foreach (var control in Model.controls.Where(e => e.SectionCode == item.SectionCode && e.isApplicableForTable == 0))
                                    {
                                        intHeaderRecord = intHeaderRecord + 1;

                                        <div class="mb-3">
                                            @Html.Label(control.LableName, new { @class = "form-control col-md-12" })

                                            <label for="formGroupExampleInput" class="form-label">@control.LableName</label>

                                            @if (control.ControlType.ToLower() == "TextBox".ToLower())
                                            {
                                                strVar = control.value != null ? control.value.ToString() : string.Empty;

                                                @Html.TextBox(control.FieldName, strVar, new { @class = "form-control form-control-sm col-md-12" })//, @required = control.isRequired ? "required" : null

                                            }
                                            @if (control.ControlType.ToLower() == "Date".ToLower())
                                            {
                                                //strVar = control.value;
                                                if (control.value == null)
                                                {
                                                    @Html.TextBox(control.FieldName, DateTime.Now.ToString("yyyy-MM-dd"), new { @class = "form-control form-control-sm col-md-12", @type = "date", @value = DateTime.Now.ToString("yyyy-MM-dd") })
                                                }
                                                else
                                                {
                                                    @Html.TextBox(control.FieldName, DateTime.Now.ToString("yyyy-MM-dd"), new { @class = "form-control form-control-sm col-md-12", @type = "date", @value = control.value.ToString("yyyy-MM-dd") })
                                                }

                                            }
                                            @if (control.ControlType.ToLower() == "DropDownList".ToLower())
                                            {
                                                strVar = control.value;

                                                @Html.DropDownList(control.FieldName, control.listValues, "Select an option", new { @class = "form-control js-example-tags", @value = strVar })
                                                @Html.DropDownList(control.FieldName,
                                                new SelectList(control.listValues, "Value", "Text", strVar),
                                                "Select an option",
                                                new { @class = "form-control js-example-tags " })


                                            }
                                            @if (control.ControlType.ToLower() == "TextArea".ToLower())
                                            {
                                                strVar = control.value;

                                                @Html.TextArea(control.FieldName, strVar, new { @class = "form-control form-control-sm " })

                                            }
                                            @if (control.ControlType.ToLower() == "CheckBox".ToLower())
                                            {
                                                intVar = (control.value == null ? 0 : control.value);

                                                @Html.CheckBox(control.FieldName, (intVar == 0 ? false : true))

                                            }
                                            @if (control.ControlType.ToLower() == "ListBox".ToLower())
                                            {
                                                strVar = control.value;

                                                @Html.ListBox(control.FieldName, new SelectList(control.listValues, "Value", "Text"), new { @class = " form-control-sm" })

                                            }
                                            @if (control.ControlType.ToLower() == "RadioButton".ToLower())
                                            {
                                                strVar = control.value;
                                                <fieldset>
                                                    @foreach (var option in control.listValues)
                                                    {
                                                        <label>
                                                            @Html.RadioButton(control.FieldName, option.Value, strVar == "Option1") @option.Text
                                                        </label>

                                                    }
                                                </fieldset>

                                            }


                                        </div>

                                    }
                                </div>
                            </div>
                        }

                        else
                        {
                            intCount = 0;
                            <div id="collapse@(item.SectionCode)" class="collapse show" aria-labelledby="heading@(item.SectionCode)" data-parent="#accordionExample">
                                <div class="card-body">
                                    <table class="table table-hover" id="Table@(item.SectionCode)">
                                        <thead>
                                            <tr>
                                                @foreach (var col in Model.ezTemplateMaster.Distinct().Where(m => m.SectionCode == item.SectionCode))
                                                {
                                                    if (col.isHidden == 1)
                                                        {
                                                            <th scope="col" hidden>@col.LableName</th>
                                                        }
                                                        else
                                                        {
                                                    <th scope="col">@col.LableName</th>
                                                     }
                                                    intCount = intCount + 1;
                                                }
                                            </tr>
                                        </thead>
                                        <tbody id="@(item.SectionCode)">
                                            @{
                                                var intTotalRecordForSection = Model.controls.Where(m => m.SectionCode == item.SectionCode).Count();
                                                var intTotalRecord = intTotalRecordForSection / @intCount;// ((Model.controls.Count- intHeaderRecord) / @intCount);
                                                var intCurRecordNumber = 0;
                                                var intColumnCount = 0;
                                            }

                                            @for (int intRecord = 1; intRecord <= intTotalRecord; intRecord++)
                                            {

                                                <tr>
                                                    @for (int i = intCurRecordNumber; intCurRecordNumber <= Model.controls.Where(m => m.SectionCode == item.SectionCode).Count() + intHeaderRecord; i++)
                                                    {


                                                        var control = Model.controls[i];
                                                        if (item.SectionCode == control.SectionCode)
                                                        {
                                                            //foreach (var Detailcontrol in Model.controls.Where(e => e.SectionCode == item.SectionCode && e.isApplicableForTable == 1))
                                                            //{
                                                            if (control.ControlType.ToLower() == "TextBox".ToLower())
                                                            {
                                                                strVar = control.value != null ? control.value.ToString() : string.Empty;
                                                                <td data-search=@strVar>
                                                                    @Html.TextBox(control.FieldName, strVar, new { @class = "form-control", @id = @item.SectionCode + "_" + control.FieldName + "_" + i })
                                                                </td>
                                                            }
                                                            if (control.ControlType.ToLower() == "Date".ToLower())
                                                            {
                                                                strVar = control.value;
                                                                <td data-search=@strVar>
                                                                    @Html.TextBox(control.FieldName, DateTime.Now.ToString("yyyy-MM-dd"), new { @class = "form-control", @type = "date", @id = @item.SectionCode + "_" + control.FieldName + "_" + i })
                                                                </td>
                                                            }
                                                            if (control.ControlType.ToLower() == "DropDownList".ToLower())
                                                            {
                                                                strVar = control.value;
                                                                <td data-search=@strVar>
                                                                    @Html.DropDownList(control.FieldName, control.listValues, "Select an option", new { @class = "form-control js-example-tags", @value = strVar })
                                                                    @Html.DropDownList(control.FieldName,
                                                                     new SelectList(control.listValues, "Value", "Text", strVar),
                                                                     "Select an option",
                                                                     new { @class = "form-control js-example-tags", @id = @item.SectionCode + "_" + control.FieldName + "_" + i })
                                                                </td>

                                                            }
                                                            if (control.ControlType.ToLower() == "TextArea".ToLower())
                                                            {
                                                                strVar = control.value;
                                                                <td data-search=@strVar>
                                                                    @Html.TextArea(control.FieldName, strVar, new { @class = "form-control", @id = @item.SectionCode + "_" + control.FieldName + "_" + i })
                                                                </td>
                                                            }
                                                            if (control.ControlType.ToLower() == "CheckBox".ToLower())
                                                            {
                                                                intVar = (control.value == null ? 0 : control.value);
                                                                <td data-search=@intVar>
                                                                    @Html.CheckBox(control.FieldName, (intVar == 0 ? false : true), new { @id = @item.SectionCode + "_" + control.FieldName + "_" + i })
                                                                </td>
                                                            }
                                                            if (control.ControlType.ToLower() == "ListBox".ToLower())
                                                            {
                                                                strVar = control.value;
                                                                <td data-search=@strVar>
                                                                    @Html.ListBox(control.FieldName, new SelectList(control.listValues, "Value", "Text"), new { @class = "form-control", @id = @item.SectionCode + "_" + control.FieldName + "_" + i })
                                                                </td>
                                                            }
                                                            if (control.ControlType.ToLower() == "RadioButton".ToLower())
                                                            {
                                                                <td>
                                                                    @Html.RadioButton(control.FieldName, "1", new { @class = "form-control", @id = @item.SectionCode + "_" + control.FieldName + "_" + i })
                                                                    @Html.RadioButton(control.FieldName, "2", new { @class = "form-control", @id = @item.SectionCode + "_" + control.FieldName + "_" + i })
                                                                    @Html.RadioButton(control.FieldName, "3", new { @class = "form-control", @id = @item.SectionCode + "_" + control.FieldName + "_" + i })
                                                                </td>
                                                            }

                                                            intColumnCount = intColumnCount + 1;


                                                        }

                                                        intCurRecordNumber++;
                                                        //Checking condition for column count reach to end or equal to total columns
                                                        if (intCount == intColumnCount)
                                                        {
                                                            intColumnCount = 0;
                                                            break;
                                                        }

                                                    }
                                                </tr>
                                            }

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        }

                    </div>
                }
            }
            else
            {

                @Html.Partial("ForEditDisplayRecordView", Model)
            }

        </div>*@
</body>
